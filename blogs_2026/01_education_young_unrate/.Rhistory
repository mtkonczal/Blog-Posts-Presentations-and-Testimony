group_by(year) %>%
mutate(share = pop / sum(pop)) %>%
ungroup()
p_bar <- ggplot(bar_data, aes(x = edu_cat, y = share, fill = factor(year))) +
geom_col(position = "dodge", width = 0.7) +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
scale_fill_manual(
values = c("2000" = "#7570b3", "2019" = "#d95f02", "2024" = "#1b9e77"),
name = "Year"
) +
labs(
title = "Education distribution of 22-27 year olds",
subtitle = "Share of population by highest education level",
x = NULL,
y = "Share of 22-27 population",
caption = "Source: CPS Microdata, Author's Calculations"
) +
theme_minimal(base_size = 12) +
theme(
axis.text.x = element_text(angle = 15, hjust = 1),
legend.position = "top"
)
ggsave("graphics/edu_distribution_bar.png", p_bar, width = 10, height = 6, dpi = 150)
# ── 4. Line chart: Monthly shares with 12-month MA, faceted ─────────────────
monthly_shares <- cps %>%
group_by(date, edu_cat) %>%
summarize(pop = sum(wtfinl, na.rm = TRUE), .groups = "drop") %>%
group_by(date) %>%
mutate(share = pop / sum(pop)) %>%
ungroup() %>%
arrange(edu_cat, date) %>%
group_by(edu_cat) %>%
mutate(share_ma12 = zoo::rollmean(share, k = 12, align = "right", fill = NA)) %>%
ungroup() %>%
filter(!is.na(share_ma12))
p_lines <- ggplot(monthly_shares, aes(x = date, y = share_ma12)) +
geom_line(linewidth = 0.8, color = "#1b9e77") +
geom_vline(xintercept = as.Date(c("2000-01-01", "2019-01-01", "2024-01-01")),
linetype = "dashed", alpha = 0.4) +
facet_wrap(~ edu_cat, scales = "free_y", ncol = 2) +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
scale_x_date(date_breaks = "5 years", date_labels = "%Y") +
labs(
title = "Education shares among 22-27 year olds over time",
subtitle = "12-month rolling average",
x = NULL,
y = "Share of 22-27 population",
caption = "Source: CPS Microdata, Author's Calculations"
) +
theme_minimal(base_size = 11) +
theme(
strip.text = element_text(face = "bold"),
panel.grid.minor = element_blank()
)
ggsave("graphics/edu_distribution_lines.png", p_lines, width = 10, height = 8, dpi = 150)
cat("Done! Saved to graphics/edu_distribution_bar.png and graphics/edu_distribution_lines.png\n")
# ── 5. Print summary table ──────────────────────────────────────────────────
cat("\nEducation distribution for 22-27 year olds:\n\n")
bar_data %>%
mutate(share = percent(share, accuracy = 0.1)) %>%
pivot_wider(names_from = year, values_from = c(share, pop)) %>%
select(edu_cat, share_2000, share_2019, share_2024) %>%
print()
cps <- cps_raw %>%
filter(age >= 24, age <= 27) %>%
transmute(
date = make_date(year, month, 1),
year = year,
age = age,
wtfinl = wtfinl,
educ = educ,
edu_cat = case_when(
educ < 73 ~ "No HS",
educ >= 73 & educ < 80 ~ "HS Only",
educ >= 80 & educ < 111 ~ "Some College",
educ == 111 ~ "Bachelor's",
educ > 111 ~ "Graduate+"
)
) %>%
mutate(
edu_cat = factor(edu_cat, levels = c("No HS", "HS Only", "Some College", "Bachelor's", "Graduate+"))
)
# ── 3. Bar chart: Education shares for 2000, 2019, 2024 ────────────────────
bar_data <- cps %>%
filter(year %in% c(2000, 2019, 2024)) %>%
group_by(year, edu_cat) %>%
summarize(pop = sum(wtfinl, na.rm = TRUE), .groups = "drop") %>%
group_by(year) %>%
mutate(share = pop / sum(pop)) %>%
ungroup()
p_bar <- ggplot(bar_data, aes(x = edu_cat, y = share, fill = factor(year))) +
geom_col(position = "dodge", width = 0.7) +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
scale_fill_manual(
values = c("2000" = "#7570b3", "2019" = "#d95f02", "2024" = "#1b9e77"),
name = "Year"
) +
labs(
title = "Education distribution of 22-27 year olds",
subtitle = "Share of population by highest education level",
x = NULL,
y = "Share of 22-27 population",
caption = "Source: CPS Microdata, Author's Calculations"
) +
theme_minimal(base_size = 12) +
theme(
axis.text.x = element_text(angle = 15, hjust = 1),
legend.position = "top"
)
ggsave("graphics/edu_distribution_bar.png", p_bar, width = 10, height = 6, dpi = 150)
# ── 4. Line chart: Monthly shares with 12-month MA, faceted ─────────────────
monthly_shares <- cps %>%
group_by(date, edu_cat) %>%
summarize(pop = sum(wtfinl, na.rm = TRUE), .groups = "drop") %>%
group_by(date) %>%
mutate(share = pop / sum(pop)) %>%
ungroup() %>%
arrange(edu_cat, date) %>%
group_by(edu_cat) %>%
mutate(share_ma12 = zoo::rollmean(share, k = 12, align = "right", fill = NA)) %>%
ungroup() %>%
filter(!is.na(share_ma12))
p_lines <- ggplot(monthly_shares, aes(x = date, y = share_ma12)) +
geom_line(linewidth = 0.8, color = "#1b9e77") +
geom_vline(xintercept = as.Date(c("2000-01-01", "2019-01-01", "2024-01-01")),
linetype = "dashed", alpha = 0.4) +
facet_wrap(~ edu_cat, scales = "free_y", ncol = 2) +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
scale_x_date(date_breaks = "5 years", date_labels = "%Y") +
labs(
title = "Education shares among 22-27 year olds over time",
subtitle = "12-month rolling average",
x = NULL,
y = "Share of 22-27 population",
caption = "Source: CPS Microdata, Author's Calculations"
) +
theme_minimal(base_size = 11) +
theme(
strip.text = element_text(face = "bold"),
panel.grid.minor = element_blank()
)
ggsave("graphics/edu_distribution_lines.png", p_lines, width = 10, height = 8, dpi = 150)
cat("Done! Saved to graphics/edu_distribution_bar.png and graphics/edu_distribution_lines.png\n")
# ── 5. Print summary table ──────────────────────────────────────────────────
cat("\nEducation distribution for 22-27 year olds:\n\n")
bar_data %>%
mutate(share = percent(share, accuracy = 0.1)) %>%
pivot_wider(names_from = year, values_from = c(share, pop)) %>%
select(edu_cat, share_2000, share_2019, share_2024) %>%
print()
# ── 0. Libraries ────────────────────────────────────────────────────────────
library(tidyverse)
library(lubridate)
library(ipumsr)
library(janitor)
library(scales)
# ── 1. Load CPS ─────────────────────────────────────────────────────────────
cps_raw <- read_ipums_micro(
"/Users/mtkonczal/Documents/data_folder/cps_00034.xml"
) |>
clean_names()
# ── 2. Define education categories ──────────────────────────────────────────
# IPUMS CPS educ codes:
#   < 73: Less than HS diploma
#   73: HS diploma/GED
#   80-92: Some college / Associate's degree
#   111: Bachelor's degree
#   > 111: Graduate/professional degree
cps <- cps_raw %>%
filter(age >= 24, age <= 27, year >= 2000) %>%
transmute(
year = year,
age = age,
wtfinl = wtfinl,
educ = educ,
edu_cat = case_when(
educ < 73 ~ "No HS",
educ >= 73 & educ < 80 ~ "HS Only",
educ >= 80 & educ < 111 ~ "Some College",
educ == 111 ~ "Bachelor's",
educ > 111 ~ "Graduate+"
)
) %>%
mutate(
edu_cat = factor(edu_cat, levels = c("No HS", "HS Only", "Some College", "Bachelor's", "Graduate+"))
)
# ── 3. Annual averages ──────────────────────────────────────────────────────
annual_shares <- cps %>%
group_by(year, edu_cat) %>%
summarize(pop = sum(wtfinl, na.rm = TRUE), .groups = "drop") %>%
group_by(year) %>%
mutate(share = pop / sum(pop)) %>%
ungroup()
# ── 4. Bar chart: Education shares for 2000, 2019, 2024 ────────────────────
bar_data <- annual_shares %>%
filter(year %in% c(2000, 2019, 2024))
p_bar <- ggplot(bar_data, aes(x = edu_cat, y = share, fill = factor(year))) +
geom_col(position = "dodge", width = 0.7) +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
scale_fill_manual(
values = c("2000" = "#7570b3", "2019" = "#d95f02", "2024" = "#1b9e77"),
name = "Year"
) +
labs(
title = "Education distribution of 24-27 year olds",
subtitle = "Share of population by highest education level",
x = NULL,
y = "Share of 24-27 population",
caption = "Source: CPS Microdata, Author's Calculations"
) +
theme_minimal(base_size = 12) +
theme(
axis.text.x = element_text(angle = 15, hjust = 1),
legend.position = "top"
)
ggsave("graphics/edu_distribution_24_27_bar.png", p_bar, width = 10, height = 6, dpi = 150)
# ── 5. Line chart: Annual shares, faceted ───────────────────────────────────
p_lines <- ggplot(annual_shares, aes(x = year, y = share)) +
geom_line(linewidth = 0.8, color = "#1b9e77") +
geom_point(size = 1.2, color = "#1b9e77") +
geom_vline(xintercept = c(2000, 2019, 2024), linetype = "dashed", alpha = 0.4) +
facet_wrap(~ edu_cat, scales = "free_y", ncol = 2) +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
scale_x_continuous(breaks = seq(2000, 2025, 5)) +
labs(
title = "Education shares among 24-27 year olds over time",
subtitle = "Annual averages, 2000-present",
x = NULL,
y = "Share of 24-27 population",
caption = "Source: CPS Microdata, Author's Calculations"
) +
theme_minimal(base_size = 11) +
theme(
strip.text = element_text(face = "bold"),
panel.grid.minor = element_blank()
)
ggsave("graphics/edu_distribution_24_27_lines.png", p_lines, width = 10, height = 8, dpi = 150)
cat("Done! Saved to graphics/edu_distribution_24_27_bar.png and graphics/edu_distribution_24_27_lines.png\n")
# ── 6. Print summary table ──────────────────────────────────────────────────
cat("\nEducation distribution for 24-27 year olds:\n\n")
bar_data %>%
mutate(share = percent(share, accuracy = 0.1)) %>%
pivot_wider(names_from = year, values_from = c(share, pop)) %>%
select(edu_cat, share_2000, share_2019, share_2024) %>%
print()
#| echo: false
library(tidyverse)
library(lubridate)
library(broom)
library(janitor)
library(slider)
library(scales)
library(blsR)
library(zoo)
bls_set_key(Sys.getenv("BLS_KEY"))
my_style <- list(
theme_classic(base_size = 13),
theme(
axis.line = element_line(linewidth = 0.25),
panel.grid.major.y = element_line(color = "gray85", linewidth = 0.25),
panel.grid.major.x = element_line(color = "gray85", linewidth = 0.25),
panel.grid.minor = element_blank(),
plot.title = element_text(face = "bold"),
plot.title.position = "plot",
legend.position = "top",
legend.title = element_blank()
),
coord_cartesian(clip = "off")
)
# Output settings for blog-sized figures.
plot_dir <- "graphics"
dir.create(plot_dir, showWarnings = FALSE, recursive = TRUE)
plot_width <- 6.0
plot_height <- 4.2
plot_dpi <- 225
# Helper function to fetch BLS series with interpolation for missing months
fetch_bls_series <- function(series_ids, start_year = 1994, end_year = 2025) {
raw <- get_n_series_table(
series_ids,
start_year = start_year,
end_year = end_year,
api_key = bls_get_key()
)
df <- raw %>%
mutate(
month_num = as.integer(gsub("M", "", period)),
date = as.Date(paste0(year, "-", month_num, "-01"))
) %>%
select(date, all_of(series_ids)) %>%
mutate(across(-date, as.numeric))
# Interpolate missing months (e.g., October 2025)
date_range <- seq(min(df$date), max(df$date), by = "month")
df %>%
right_join(tibble(date = date_range), by = "date") %>%
arrange(date) %>%
mutate(across(-date, ~ zoo::na.approx(.x, na.rm = FALSE)))
}
# Fetch unemployment rates for setup
setup_series <- fetch_bls_series(c(
"LNS14000000",  # Total unemployment
"LNS14000006",  # Black
"LNS14027660",  # HS grad
"LNS14027662",  # College
"LNS14000001",  # Men
"LNS14000093"   # Age 45-54
))
unrate <- setup_series %>%
rename(
full_unrate = LNS14000000,
black_unrate = LNS14000006,
hs_grad = LNS14027660,
all_college = LNS14027662,
men_unrate = LNS14000001,
age_45_54 = LNS14000093
) %>%
mutate(across(-date, ~ .x / 100)) %>%
filter(year(date) >= 1994)
# ---- Pull data using BLS API ----
all_series_raw <- fetch_bls_series(c(
"LNS14000000",  # Total
"LNS14000001",  # Men
"LNS14000002",  # Women
"LNS14000003",  # White
"LNS14000006",  # Black
"LNS14000009",  # Hispanic
"LNS14000012",  # Age 16-19
"LNS14000036",  # Age 20-24
"LNS14000089",  # Age 25-34
"LNS14000091",  # Age 35-44
"LNS14000093",  # Age 45-54
"LNS14024230",  # Age 55+
"LNS14027659",  # < HS
"LNS14027660",  # HS only
"LNS14027689",  # Some college
"LNS14027662"   # BA+
))
# Rename columns
all_series <- all_series_raw %>%
rename(
total = LNS14000000,
men = LNS14000001,
women = LNS14000002,
white = LNS14000003,
black = LNS14000006,
hispanic = LNS14000009,
age_16_19 = LNS14000012,
age_20_24 = LNS14000036,
age_25_34 = LNS14000089,
age_35_44 = LNS14000091,
age_45_54 = LNS14000093,
age_55_plus = LNS14024230,
edu_lt_hs = LNS14027659,
edu_hs = LNS14027660,
edu_some_college = LNS14027689,
edu_ba_plus = LNS14027662
)
# ---- Pivot to long format ----
all_long <- all_series %>%
pivot_longer(-date, names_to = "series_name", values_to = "value") %>%
filter(!is.na(value))
# ---- Get total unemployment as regressor ----
total_unrate <- all_long %>%
filter(series_name == "total") %>%
select(date, total_unrate = value)
# ---- Join and prepare regression panel ----
regression_panel <- all_long %>%
filter(series_name != "total") %>%
left_join(total_unrate, by = "date") %>%
filter(!is.na(total_unrate))
# ---- Fit per-series log-log models (train through 2019) + predict all dates ----
fit_loglog_model <- function(df) {
train_data <- df %>% filter(year(date) <= 2019)
if (nrow(train_data) < 12) {
# Not enough training data, return empty
return(df %>% mutate(prediction = NA_real_, diff = NA_real_) %>% filter(FALSE))
}
mod <- lm(log(value) ~ log(total_unrate), data = train_data)
df %>%
mutate(
prediction = exp(predict(mod, newdata = df)),
diff = value - prediction
)
}
results <- regression_panel %>%
filter(value > 0, total_unrate > 0) %>%
group_by(series_name) %>%
group_modify(~ fit_loglog_model(.x)) %>%
ungroup() %>%
filter(!is.na(diff))
# ---- Average (actual - predicted) over last 2 months, per series ----
last_date <- max(results$date, na.rm = TRUE)
cutoff <- floor_date(last_date %m-% months(1), unit = "month")  # 2 months inclusive
avg_diff_2m <- results %>%
filter(date >= cutoff) %>%
group_by(series_name) %>%
summarise(
avg_diff_2m = mean(diff, na.rm = TRUE),
.groups = "drop"
)
# ---- Create nice labels ----
label_lookup <- c(
men = "Men", women = "Women",
white = "White", black = "Black", hispanic = "Hispanic", asian = "Asian",
age_16_19 = "Age 16-19", age_20_24 = "Age 20-24", age_25_34 = "Age 25-34",
age_35_44 = "Age 35-44", age_45_54 = "Age 45-54", age_55_plus = "Age 55+",
edu_lt_hs = "< High school (25+)", edu_hs = "HS only (25+)",
edu_some_college = "Some college (25+)", edu_ba_plus = "BA+ (25+)"
)
avg_diff_2m <- avg_diff_2m %>%
mutate(label = label_lookup[series_name]) %>%
filter(!is.na(label)) %>%
arrange(avg_diff_2m)
# ---- Bar chart ----
fig_2 <- ggplot(avg_diff_2m, aes(x = avg_diff_2m, y = reorder(label, avg_diff_2m))) +
geom_col(fill = "#2c3254") +
geom_vline(xintercept = 0, linewidth = 0.5) +
scale_x_continuous(labels = function(x) paste0(x, " pp")) +
labs(
title = "Figure 2: Average Actual Minus Predicted Unemployment",
subtitle = paste0(
"Average over last 2 months (",
format(cutoff, "%b %Y"), " to ", format(last_date, "%b %Y"),
"); model trained through 2019"
),
x = "Avg (Actual - Predicted), percentage points",
y = NULL,
caption = "Source: BLS, Author's Calculations, Mike Konczal"
) +
my_style
ggsave(
filename = file.path(plot_dir, "figure-2.png"),
plot = fig_2,
width = plot_width,
height = plot_height,
dpi = plot_dpi
)
fig_2
# ---- Fit model pre-2020: Black unemployment on overall unemployment ----
model_black <- lm(
log(black_unrate) ~ log(full_unrate),
data = unrate %>% filter(year(date) < 2020)
)
# ---- Add prediction ----
unrate <- unrate %>%
mutate(predict_black = exp(predict(model_black, newdata = unrate)))
# ---- Long format for 2-line plot ----
plot_black <- unrate %>%
transmute(
date,
actual = black_unrate,
projection = predict_black
) %>%
pivot_longer(-date, names_to = "type", values_to = "value") %>%
mutate(
type = recode(type, actual = "Actual", projection = "Projection")
)
# ---- Full history plot (Figure 3.a) ----
fig_3a <- plot_black %>%
ggplot(aes(x = date, y = value, color = type, linetype = type)) +
geom_line(linewidth = 1) +
scale_color_manual(values = c("Actual" = "#2c3254", "Projection" = "gray50")) +
scale_linetype_manual(values = c("Actual" = "solid", "Projection" = "dotted")) +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
labs(
title = "Figure 3.a: Black Unemployment Tracks Its Historical Trend",
subtitle = "Black unemployment rate: Actual vs. predicted from overall unemployment (1994-2019)",
x = NULL,
y = NULL,
color = NULL,
linetype = NULL,
caption = "Source: BLS, Author's Calculations, Mike Konczal"
) +
my_style
ggsave(
filename = file.path(plot_dir, "figure-3a.png"),
plot = fig_3a,
width = plot_width,
height = plot_height,
dpi = plot_dpi
)
fig_3a
# ---- Post-2021 zoom plot (Figure 3.b) ----
fig_3b <- plot_black %>%
filter(year(date) >= 2021) %>%
ggplot(aes(x = date, y = value, color = type, linetype = type)) +
geom_line(linewidth = 1.2) +
scale_color_manual(values = c("Actual" = "#2c3254", "Projection" = "gray50")) +
scale_linetype_manual(values = c("Actual" = "solid", "Projection" = "dotted")) +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
labs(
title = "Figure 3.b: Black Unemployment Returns to Historical Trend",
subtitle = "Black unemployment rate: Actual vs. predicted from overall unemployment (1994-2019)",
x = NULL,
y = NULL,
color = NULL,
linetype = NULL,
caption = "Source: BLS, Author's Calculations, Mike Konczal"
) +
my_style
ggsave(
filename = file.path(plot_dir, "figure-3b.png"),
plot = fig_3b,
width = plot_width,
height = plot_height,
dpi = plot_dpi
)
fig_3b
model_black
model_black$coefficients
model_black$coefficients$IN
summary(model_black)
exp(0.91935)
