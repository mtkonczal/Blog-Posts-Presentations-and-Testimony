summary(
lm(
FREVER ~ race + nativity + college + grad_school + married + AGE + YEAR,
data = fert24 %>% filter,
weights = FRSUPPWT
)
)
fert24 %>%
mutate(
college = if_else(EDUC >= 111, 1, 0)) %>%
group_by(college) %>%
summarize(number = weighted.mean(FREVER, FRSUPPWT),
my_number = sum(FREVER*FRSUPPTW)/sum(FRSUPPWT))
fert24 %>%
mutate(
college = if_else(EDUC >= 111, 1, 0)) %>%
group_by(college) %>%
summarize(number = weighted.mean(FREVER, FRSUPPWT),
my_number = sum(FREVER*FRSUPPWT)/sum(FRSUPPWT))
library(zoo)
library(dplyr)
library(ggplot2)
df_age_year <- data %>%
filter(FREVER != 999, AGE < 45) %>%
group_by(YEAR, AGE) %>%
summarize(
avg_no_children = weighted.mean(FREVER, FRSUPPWT, na.rm = TRUE),
.groups = "drop"
) %>%
group_by(AGE) %>%
mutate(
avg_3yr = rollapply(
avg_no_children, width = 3, FUN = mean,
align = "center", partial = TRUE
)
) %>%
ungroup()
ggplot(df_age_year, aes(YEAR, avg_3yr)) +
geom_line(color = "#1b9e77", linewidth = 0.9) +
facet_wrap(~ AGE, ncol = 5, scales = "free_y") +
labs(
title = "Younger Adults Are Behind on Childbearing, But Completed Fertility Holds Steady",
subtitle = "Mean number of children ever born (3-year centered average), by age and year",
x = "Year",
y = "Average number of children",
caption = "CPS Fertility Supplement via IPUMS; weighted by FRSUPPWT"
) +
theme_classic(base_size = 11)
df_age_year <- data %>%
filter(FREVER != 999, AGE >= 20, AGE < 45) %>%
group_by(YEAR, AGE) %>%
summarize(
avg_no_children = weighted.mean(FREVER, FRSUPPWT, na.rm = TRUE),
.groups = "drop"
) %>%
group_by(AGE) %>%
mutate(
avg_3yr = rollapply(
avg_no_children, width = 3, FUN = mean,
align = "center", partial = TRUE
)
) %>%
ungroup()
ggplot(df_age_year, aes(YEAR, avg_3yr)) +
geom_line(color = "#1b9e77", linewidth = 0.9) +
facet_wrap(~ AGE, ncol = 5, scales = "free_y") +
labs(
title = "Younger Adults Are Behind on Childbearing, But Completed Fertility Holds Steady",
subtitle = "Mean number of children ever born (3-year centered average), by age and year",
x = "Year",
y = "Average number of children",
caption = "CPS Fertility Supplement via IPUMS; weighted by FRSUPPWT"
) +
theme_classic(base_size = 11)
library(zoo)
library(dplyr)
library(ggplot2)
df_age_year <- data %>%
filter(FREVER != 999, AGE >= 20, AGE < 45, YEAR >= 2000) %>%
group_by(YEAR, AGE) %>%
summarize(
avg_no_children = weighted.mean(FREVER, FRSUPPWT, na.rm = TRUE),
.groups = "drop"
) %>%
group_by(AGE) %>%
mutate(
avg_3yr = rollapply(
avg_no_children, width = 3, FUN = mean,
align = "center", partial = TRUE
)
) %>%
ungroup()
ggplot(df_age_year, aes(YEAR, avg_3yr)) +
geom_line(color = "#1b9e77", linewidth = 0.9) +
facet_wrap(~ AGE, ncol = 5, scales = "free_y") +
labs(
title = "Younger Adults Are Behind on Childbearing, But Completed Fertility Holds Steady",
subtitle = "Mean number of children ever born (3-year centered average), by age and year",
x = "Year",
y = "Average number of children",
caption = "CPS Fertility Supplement via IPUMS; weighted by FRSUPPWT"
) +
theme_classic(base_size = 11)
df_age_year <- data %>%
filter(FREVER != 999, AGE >= 21, AGE < 28, YEAR >= 2000) %>%
group_by(YEAR, AGE) %>%
summarize(
avg_no_children = weighted.mean(FREVER, FRSUPPWT, na.rm = TRUE),
.groups = "drop"
) %>%
group_by(AGE) %>%
mutate(
avg_3yr = rollapply(
avg_no_children, width = 3, FUN = mean,
align = "center", partial = TRUE
)
) %>%
ungroup()
ggplot(df_age_year, aes(YEAR, avg_3yr)) +
geom_line(color = "#1b9e77", linewidth = 0.9) +
facet_wrap(~ AGE, ncol = 5, scales = "free_y") +
labs(
title = "Younger Adults Are Behind on Childbearing, But Completed Fertility Holds Steady",
subtitle = "Mean number of children ever born (3-year centered average), by age and year",
x = "Year",
y = "Average number of children",
caption = "CPS Fertility Supplement via IPUMS; weighted by FRSUPPWT"
) +
theme_classic(base_size = 11)
df_age_year <- data %>%
filter(FREVER != 999, AGE >= 21, AGE <= 40, YEAR >= 2000) %>%
group_by(YEAR, AGE) %>%
summarize(
avg_no_children = weighted.mean(FREVER, FRSUPPWT, na.rm = TRUE),
.groups = "drop"
) %>%
group_by(AGE) %>%
mutate(
avg_3yr = rollapply(
avg_no_children, width = 3, FUN = mean,
align = "center", partial = TRUE
)
) %>%
ungroup()
ggplot(df_age_year, aes(YEAR, avg_3yr)) +
geom_line(color = "#1b9e77", linewidth = 0.9) +
facet_wrap(~ AGE, ncol = 5, scales = "free_y") +
labs(
title = "Younger Adults Are Behind on Childbearing, But Completed Fertility Holds Steady",
subtitle = "Mean number of children ever born (3-year centered average), by age and year",
x = "Year",
y = "Average number of children",
caption = "CPS Fertility Supplement via IPUMS; weighted by FRSUPPWT"
) +
theme_classic(base_size = 11)
library(zoo)
library(dplyr)
library(ggplot2)
df_age_year <- data %>%
filter(FREVER != 999, AGE >= 21, AGE <= 40, YEAR >= 2000) %>%
group_by(YEAR, AGE) %>%
summarize(
avg_no_children = weighted.mean(FREVER, FRSUPPWT, na.rm = TRUE),
.groups = "drop"
) %>%
group_by(AGE) %>%
mutate(
avg_3yr = rollapply(
avg_no_children, width = 3, FUN = mean,
align = "center", partial = TRUE
)
) %>%
ungroup()
ggplot(df_age_year, aes(YEAR, avg_3yr)) +
geom_line(color = "#1b9e77", linewidth = 0.9) +
facet_wrap(~ AGE, ncol = 5) +
labs(
title = "Younger Adults Are Behind on Childbearing, But Completed Fertility Holds Steady",
subtitle = "Mean number of children ever born (3-year centered average), by age and year",
x = "Year",
y = "Average number of children",
caption = "CPS Fertility Supplement via IPUMS; weighted by FRSUPPWT"
) +
theme_classic(base_size = 11)
df_age_year <- data %>%
filter(FREVER != 999, AGE >= 21, AGE <= 40, YEAR >= 1990) %>%
group_by(YEAR, AGE) %>%
summarize(
avg_no_children = weighted.mean(FREVER, FRSUPPWT, na.rm = TRUE),
.groups = "drop"
) %>%
group_by(AGE) %>%
mutate(
avg_3yr = rollapply(
avg_no_children, width = 3, FUN = mean,
align = "center", partial = TRUE
)
) %>%
ungroup()
ggplot(df_age_year, aes(YEAR, avg_3yr)) +
geom_line(color = "#1b9e77", linewidth = 0.9) +
facet_wrap(~ AGE, ncol = 5) +
labs(
title = "Younger Adults Are Behind on Childbearing, But Completed Fertility Holds Steady",
subtitle = "Mean number of children ever born (3-year centered average), by age and year",
x = "Year",
y = "Average number of children",
caption = "CPS Fertility Supplement via IPUMS; weighted by FRSUPPWT"
) +
theme_classic(base_size = 11)
df_age_year <- data %>%
filter(FREVER != 999, AGE >= 21, AGE <= 40, YEAR >= 1980) %>%
group_by(YEAR, AGE) %>%
summarize(
avg_no_children = weighted.mean(FREVER, FRSUPPWT, na.rm = TRUE),
.groups = "drop"
) %>%
group_by(AGE) %>%
mutate(
avg_3yr = rollapply(
avg_no_children, width = 3, FUN = mean,
align = "center", partial = TRUE
)
) %>%
ungroup()
ggplot(df_age_year, aes(YEAR, avg_3yr)) +
geom_line(color = "#1b9e77", linewidth = 0.9) +
facet_wrap(~ AGE, ncol = 5) +
labs(
title = "Younger Adults Are Behind on Childbearing, But Completed Fertility Holds Steady",
subtitle = "Mean number of children ever born (3-year centered average), by age and year",
x = "Year",
y = "Average number of children",
caption = "CPS Fertility Supplement via IPUMS; weighted by FRSUPPWT"
) +
theme_classic(base_size = 11)
df_age_year <- data %>%
filter(FREVER != 999, AGE >= 21, AGE <= 40, YEAR >= 2000) %>%
group_by(YEAR, AGE) %>%
summarize(
avg_no_children = weighted.mean(FREVER, FRSUPPWT, na.rm = TRUE),
.groups = "drop"
) %>%
group_by(AGE) %>%
mutate(
avg_3yr = rollapply(
avg_no_children, width = 3, FUN = mean,
align = "center", partial = TRUE
)
) %>%
ungroup()
ggplot(df_age_year, aes(YEAR, avg_3yr)) +
geom_line(color = "#1b9e77", linewidth = 0.9) +
facet_wrap(~ AGE, ncol = 5, scales = "free_y") +
labs(
title = "Younger Adults Are Behind on Childbearing, But Completed Fertility Holds Steady",
subtitle = "Mean number of children ever born (3-year centered average), by age and year",
x = "Year",
y = "Average number of children",
caption = "CPS Fertility Supplement via IPUMS; weighted by FRSUPPWT"
) +
theme_classic(base_size = 11)
library(zoo)
library(dplyr)
library(ggplot2)
# --- Generation definitions (Pew Research style) ---
assign_generation <- function(byear) {
case_when(
byear >= 1997 ~ "Gen Z",
byear >= 1981 ~ "Millennial",
byear >= 1965 ~ "Gen X",
byear >= 1946 ~ "Baby Boomer",
TRUE ~ "Silent"
)
}
df_age_year <- data %>%
filter(FREVER != 999, AGE >= 21, AGE <= 40, YEAR >= 2000) %>%
mutate(
birth_year = YEAR - AGE,
generation = assign_generation(birth_year)
) %>%
group_by(YEAR, AGE, generation) %>%
summarize(
avg_no_children = weighted.mean(FREVER, FRSUPPWT, na.rm = TRUE),
.groups = "drop"
) %>%
group_by(AGE) %>%
mutate(
avg_3yr = rollapply(
avg_no_children, width = 3, FUN = mean,
align = "center", partial = TRUE
)
) %>%
ungroup()
# --- Color palette for generations ---
gen_colors <- c(
"Gen Z" = "#5e3c99",
"Millennial" = "#1b9e77",
"Gen X" = "#d95f02",
"Baby Boomer" = "#7570b3",
"Silent" = "gray60"
)
ggplot(df_age_year, aes(YEAR, avg_3yr, color = generation, group = generation)) +
geom_line(linewidth = 0.9) +
facet_wrap(~ AGE, ncol = 5, scales = "free_y") +
scale_color_manual(values = gen_colors) +
labs(
title = "Younger Adults Are Behind on Childbearing, But Completed Fertility Holds Steady",
subtitle = "Mean number of children ever born (3-year centered average), by age and generation",
x = "Year",
y = "Average number of children",
color = "Generation",
caption = "CPS Fertility Supplement via IPUMS; weighted by FRSUPPWT"
) +
theme_classic(base_size = 11) +
theme(
legend.position = "top",
plot.title.position = "plot"
)
library(zoo)
library(dplyr)
library(ggplot2)
df_age_year <- data %>%
filter(FREVER != 999, AGE >= 21, AGE <= 40, YEAR >= 2000) %>%
# 1) One row per YEAR–AGE: weighted mean births
group_by(YEAR, AGE) %>%
summarize(
avg_no_children = weighted.mean(FREVER, FRSUPPWT, na.rm = TRUE),
.groups = "drop"
) %>%
# 2) Birth year and generation
mutate(
birth_year = YEAR - AGE,
generation = case_when(
birth_year >= 1997 ~ "Gen Z",
birth_year >= 1981 ~ "Millennial",
birth_year >= 1965 ~ "Gen X",
birth_year >= 1946 ~ "Baby Boomer",
TRUE              ~ "Silent"
) |> factor(
levels = c("Silent", "Baby Boomer", "Gen X", "Millennial", "Gen Z")
)
) %>%
# 3) Sort within age and smooth over YEAR
arrange(AGE, YEAR) %>%
group_by(AGE) %>%
mutate(
avg_3yr = rollapply(
avg_no_children,
width   = 3,
FUN     = mean,
align   = "center",
partial = TRUE
)
) %>%
ungroup()
gen_colors <- c(
"Silent"      = "gray70",
"Baby Boomer" = "#7570b3",
"Gen X"       = "#d95f02",
"Millennial"  = "#1b9e77",
"Gen Z"       = "#5e3c99"
)
ggplot(df_age_year,
aes(x = YEAR, y = avg_3yr, color = generation, group = generation)) +
geom_line(linewidth = 0.9) +
facet_wrap(~ AGE, ncol = 5, scales = "free_y") +
scale_color_manual(values = gen_colors) +
scale_x_continuous(breaks = pretty(unique(df_age_year$YEAR))) +
labs(
title = "Younger Adults Are Behind on Childbearing, But Completed Fertility Holds Steady",
subtitle = "Mean number of children ever born (3-year centered average), by age and generation",
x = "Year",
y = "Average number of children",
color = "Generation",
caption = "CPS Fertility Supplement via IPUMS; weighted by FRSUPPWT"
) +
theme_classic(base_size = 11) +
theme(
legend.position = "top",
plot.title.position = "plot"
)
df_age_year
View(df_age_year)
ggplot(df_age_year,
aes(x = YEAR, y = avg_3yr, color = generation)) +
geom_line(linewidth = 0.9) +
facet_wrap(~ AGE, ncol = 5, scales = "free_y") +
scale_color_manual(values = gen_colors) +
scale_x_continuous(breaks = pretty(unique(df_age_year$YEAR))) +
labs(
title = "Younger Adults Are Behind on Childbearing, But Completed Fertility Holds Steady",
subtitle = "Mean number of children ever born (3-year centered average), by age and generation",
x = "Year",
y = "Average number of children",
color = "Generation",
caption = "CPS Fertility Supplement via IPUMS; weighted by FRSUPPWT"
) +
theme_classic(base_size = 11) +
theme(
legend.position = "top",
plot.title.position = "plot"
)
library(zoo)
library(dplyr)
library(ggplot2)
df_age_year <- data %>%
filter(FREVER != 999, AGE >= 21, AGE <= 40, YEAR >= 2000) %>%
# 1) One row per YEAR–AGE: weighted mean births
group_by(YEAR, AGE) %>%
summarize(
avg_no_children = weighted.mean(FREVER, FRSUPPWT, na.rm = TRUE),
.groups = "drop"
) %>%
# 2) Birth year and generation
mutate(
birth_year = YEAR - AGE,
generation = case_when(
birth_year >= 1997 ~ "Gen Z",
birth_year >= 1981 ~ "Millennial",
birth_year >= 1965 ~ "Gen X",
birth_year >= 1946 ~ "Baby Boomer",
TRUE              ~ "Silent"
) |> factor(
levels = c("Silent", "Baby Boomer", "Gen X", "Millennial", "Gen Z")
)
) %>%
# 3) Sort within age and smooth over YEAR
arrange(AGE, YEAR) %>%
group_by(AGE) %>%
mutate(
avg_3yr = rollapply(
avg_no_children,
width   = 3,
FUN     = mean,
align   = "center",
partial = TRUE
)
) %>%
ungroup()
gen_colors <- c(
"Silent"      = "gray70",
"Baby Boomer" = "#7570b3",
"Gen X"       = "#d95f02",
"Millennial"  = "#1b9e77",
"Gen Z"       = "#5e3c99"
)
ggplot(df_age_year,
aes(x = YEAR, y = avg_3yr,
color = generation,
group = AGE)) +   # <-- key change here
geom_line(linewidth = 0.9) +
facet_wrap(~ AGE, ncol = 5, scales = "free_y") +
scale_color_manual(values = gen_colors) +
labs(
title = "Younger Adults Are Behind on Childbearing, But Completed Fertility Holds Steady",
subtitle = "Mean number of children ever born (3-year centered average), by age and generation",
x = "Year",
y = "Average number of children",
color = "Generation",
caption = "CPS Fertility Supplement via IPUMS; weighted by FRSUPPWT"
) +
theme_classic(base_size = 11) +
theme(
legend.position = "top",
plot.title.position = "plot"
)
library(tidyverse)
library(ipumsr)
ddi <- read_ipums_ddi("../../data_folder/cps_00027.xml")
data <- read_ipums_micro(ddi)
check_all <- data %>%
filter(FREVER != 999, AGE < 51, AGE >= 40, YEAR == 2024) %>%
mutate(second_half_40s = AGE >= 45) %>%
group_by(second_half_40s) %>%
summarize(avg_no_children = weighted.mean(FREVER, FRSUPPWT, na.rm = TRUE), .groups = "drop")
library(tidyverse)
library(ipumsr)
library(tidyusmacro)
ddi <- read_ipums_ddi("../../data_folder/cps_00027.xml")
data <- read_ipums_micro(ddi)
data %>%
filter(FREVER != 999, AGE < 45) %>%
group_by(YEAR, AGE) %>%
summarize(avg_no_children = weighted.mean(FREVER, FRSUPPWT, na.rm = TRUE), .groups = "drop") %>%
group_by(YEAR) %>%
# 3-year centered average, keeping endpoints
mutate(avg_3yr = rollapply(
avg_no_children,
width = 3,
FUN = mean,
align = "center",
partial = TRUE
)) %>%
ungroup() %>%
filter(YEAR %in% c(2000, 2024))
library(zoo)
data %>%
filter(FREVER != 999, AGE < 45) %>%
group_by(YEAR, AGE) %>%
summarize(avg_no_children = weighted.mean(FREVER, FRSUPPWT, na.rm = TRUE), .groups = "drop") %>%
group_by(YEAR) %>%
# 3-year centered average, keeping endpoints
mutate(avg_3yr = rollapply(
avg_no_children,
width = 3,
FUN = mean,
align = "center",
partial = TRUE
)) %>%
ungroup() %>%
filter(YEAR %in% c(2000, 2024), AGE == 43)
