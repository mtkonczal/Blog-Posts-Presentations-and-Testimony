library(tidycensus)
library(tidyverse)
library(tinyplot)
vars <- c(
rent = "B25064_001E",
home_value = "B25077_001E",
hh_income = "B19013_001E",
total_pop = "B01003_001E",
foreign_born = "B05002_013E",
unemployed = "B23025_005E",
labor_force = "B23025_002E"
)
acs2019 <- get_acs(
geography = "county",
year = 2019,
survey = "acs1",
variables = vars,
output = "wide" # tidycensus shortcut
) %>%
rename_with(~ paste0("y2019_", .), -c(GEOID, NAME))
acs2024 <- get_acs(
geography = "county",
year = 2024,
survey = "acs1",
variables = vars,
output = "wide"
) %>%
rename_with(~ paste0("y2024_", .), -c(GEOID, NAME))
acs_change <- acs2024 %>%
inner_join(acs2019, by = "GEOID") %>%
mutate(
delta_rent = (y2024_rent - y2019_rent) / y2019_rent,
delta_rentL = log(y2024_rent) - log(y2019_rent),
delta_home_value = (y2024_home_value - y2019_home_value) / y2019_home_value,
delta_income = (y2024_hh_income - y2019_hh_income) / y2019_hh_income,
delta_pop = y2024_total_pop - y2019_total_pop,
delta_pop_rate = (y2024_total_pop - y2019_total_pop) / y2019_total_pop,
delta_pop_rateL = log(y2024_total_pop) - log(y2019_total_pop),
delta_foreign_share = (y2024_foreign_born / y2024_total_pop) -
(y2019_foreign_born / y2019_total_pop),
delta_foreign = (y2024_foreign_born - y2019_foreign_born) /
y2019_foreign_born,
# Compute unemployment rates for each year
y2019_unemp_rate = y2019_unemployed / y2019_labor_force,
y2024_unemp_rate = y2024_unemployed / y2024_labor_force,
# Change in unemployment rate (percentage points)
delta_unemp_rate = y2024_unemp_rate - y2019_unemp_rate
)
m1 <- lm(
delta_rent ~ delta_foreign_share,
weights = y2024_total_pop,
data = acs_change
)
m2 <- lm(
delta_rent ~ delta_foreign_share + ,
m1 <- lm(
delta_rent ~ delta_foreign_share,
weights = y2024_total_pop,
data = acs_change
)
m2 <- lm(
delta_rent ~ delta_foreign_share + delta_income,
weights = y2024_total_pop,
data = acs_change
)
model_final <- lm(
delta_rent ~ delta_foreign_share + delta_income,
weights = y2024_total_pop,
data = acs_change
)
summary(model_final)
summary(m1)
m1 <- lm(
delta_rent ~ delta_foreign_share,
weights = y2024_total_pop,
data = acs_change
)
m2 <- lm(
delta_rent ~ delta_foreign_share + delta_income,
weights = y2024_total_pop,
data = acs_change
)
model_final <- lm(
delta_rent ~ delta_foreign_share + delta_income,
weights = y2024_total_pop,
data = acs_change
)
summary(model_final)
summary(m2)
m1 <- lm(
delta_rent ~ delta_foreign_share,
weights = y2024_total_pop,
data = acs_change
)
m2 <- lm(
delta_rent ~ delta_foreign_share + delta_income,
weights = y2024_total_pop,
data = acs_change
)
model_final <- lm(
delta_rent ~ delta_foreign_share + delta_income,
weights = y2024_total_pop,
data = acs_change
)
summary(m1)
summary(m2)
m1 <- lm(
delta_rent ~ delta_foreign_share,
weights = y2024_total_pop,
data = acs_change
)
m2 <- lm(
delta_rent ~ delta_foreign_share + delta_income,
weights = y2024_total_pop,
data = acs_change
)
model_final <- lm(
delta_rent ~ delta_foreign + delta_income,
weights = y2024_total_pop,
data = acs_change
)
summary(m1)
summary(m2)
m1 <- lm(
delta_rent ~ delta_foreign_share,
weights = y2024_total_pop,
data = acs_change
)
m2 <- lm(
delta_rent ~ delta_foreign_share + delta_income,
weights = y2024_total_pop,
data = acs_change
)
m3 <- lm(
delta_rent ~ delta_foreign + delta_income,
weights = y2024_total_pop,
data = acs_change
)
summary(m1)
summary(m3)
m1 <- lm(
delta_rent ~ delta_foreign_share,
weights = y2024_total_pop,
data = acs_change
)
m2 <- lm(
delta_rent ~ delta_foreign_share + delta_income,
weights = y2024_total_pop,
data = acs_change
)
m3 <- lm(
delta_rent ~ delta_foreign + delta_income,
weights = y2024_total_pop,
data = acs_change
)
m4 <- lm(
delta_rent ~ delta_foreign + delta_income + delta_pop_rate,
weights = y2024_total_pop,
data = acs_change
)
summary(m1)
summary(m4)
install.packages("gtsummary")
# load_data.R
library(tidycensus)
library(tidyverse)
# --- 1. Define Variables ---
vars <- c(
rent = "B25064_001E",          # Median Gross Rent
hh_income = "B19013_001E",     # Median Household Income
total_pop = "B01003_001E",     # Total Population
housing_units = "B25001_001E", # Total Housing Units
foreign_born = "B05002_013E"   # Foreign Born Population
)
# --- 2. Helper Function to Fetch Data ---
fetch_year <- function(yr) {
message(paste("Fetching ACS 1-year data for:", yr))
get_acs(
geography = "county",
year = yr,
survey = "acs1",
variables = vars,
output = "wide"
) %>%
select(-NAME) %>%
rename_with(~ paste0("y", yr, "_", .), -GEOID)
}
# --- 3. Download All Snapshots ---
# We need 2024, 2019, 2014, 2009, 2005
df_2024 <- fetch_year(2024)
df_2019 <- fetch_year(2019)
df_2014 <- fetch_year(2014)
df_2009 <- fetch_year(2009)
df_2005 <- fetch_year(2005)
# --- 4. Process Current Period (2019-2024) ---
current_change <- df_2024 %>%
inner_join(df_2019, by = "GEOID") %>%
mutate(
period = "2019-2024",
delta_rent = log(y2024_rent) - log(y2019_rent),
delta_income = log(y2024_hh_income) - log(y2019_hh_income),
delta_pop_rate = log(y2024_total_pop) - log(y2019_total_pop),
delta_housing_supply = log(y2024_housing_units) - log(y2019_housing_units),
# Saiz Inflow
immigrant_inflow = (y2024_foreign_born - y2019_foreign_born) / y2019_total_pop,
# Elasticity Check
delta_foreign_log = log(y2024_foreign_born) - log(y2019_foreign_born),
# Weight
pop_weight = y2024_total_pop
) %>%
filter(is.finite(delta_rent), is.finite(immigrant_inflow), is.finite(delta_foreign_log))
# --- 5. Process Historical Batches (2005-2019) ---
create_batch <- function(data_end, data_start, end_year, start_year) {
rent_end <- paste0("y", end_year, "_rent")
rent_start <- paste0("y", start_year, "_rent")
inc_end <- paste0("y", end_year, "_hh_income")
inc_start <- paste0("y", start_year, "_hh_income")
pop_end <- paste0("y", end_year, "_total_pop")
pop_start <- paste0("y", start_year, "_total_pop")
fb_end <- paste0("y", end_year, "_foreign_born")
fb_start <- paste0("y", start_year, "_foreign_born")
data_end %>%
inner_join(data_start, by = "GEOID") %>%
mutate(
period = paste0(start_year, "-", end_year),
delta_rent = log(.data[[rent_end]]) - log(.data[[rent_start]]),
delta_income = log(.data[[inc_end]]) - log(.data[[inc_start]]),
immigrant_inflow = (.data[[fb_end]] - .data[[fb_start]]) / .data[[pop_start]],
pop_weight = .data[[pop_end]]
) %>%
select(GEOID, period, delta_rent, delta_income, immigrant_inflow, pop_weight) %>%
filter(is.finite(delta_rent), is.finite(immigrant_inflow))
}
historical_panel <- bind_rows(
create_batch(df_2019, df_2014, 2019, 2014),
create_batch(df_2014, df_2009, 2014, 2009),
create_batch(df_2009, df_2005, 2009, 2005)
)
# --- 6. Save Both to a List ---
final_data <- list(
current = current_change,
history = historical_panel
)
write_rds(final_data, "data_immigration_rent.rds")
message("Done! Saved 'data_immigration_rent.rds' containing both current and historical data.")
