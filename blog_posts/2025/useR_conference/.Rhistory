knitr::opts_chunk$set(
echo = FALSE,
warning = FALSE,
message = FALSE
)
library(tidyverse)
library(govMacroTools)
library(lubridate)
library(scales)
library(glue)
library(blsR)
library(janitor)
library(showtext)
library(grid)
library(tidycensus)
font_add_google("Fira Sans", "fira")
showtext_auto()
knitr::opts_chunk$set(
fig.width = 7,   # narrower default width
fig.height = 2.8, # shorter default height
fig.align = "center",
out.width = "95%" # scale image within slide
)
knitr::knit_hooks$set(
size = function(before, options, envir) {
if (before) {
# before the chunk starts
paste0("\\", options$size)   # e.g. \tiny  \scriptsize
} else {
"\\normalsize"               # reset after the chunk
}
}
)
all_dates <- seq(from = as.Date("2000-01-01"), to = as.Date("2025-04-01"), by = "month")
create_chart_dates <- function(df, x){
return_dates <- sort(unique(df), decreasing = TRUE)
return_dates <- return_dates[seq(1, length(return_dates), x)]
return(return_dates)
}
theme_chartbook <- function() {
theme_void(base_family = "fira", base_size = 12) +
theme(
plot.title = element_text(size = 12, hjust = 0),
plot.title.position = "plot",
plot.background = element_rect(fill = NA, color = NA),
panel.background = element_rect(fill = NA, color = NA),
axis.text = element_text(size = 12),
axis.title = element_blank(),
panel.grid = element_blank(),
legend.title = element_blank()
)
}
scale_chartbook_colors <- function() {
scale_color_manual(values = presentation_two_colors)
}
scale_chartbook_fill <- function() {
scale_fill_manual(values = presentation_two_colors)
}
presentation_two_colors <- c("#2c3254", "#ff8361")  # Blue, red (or whatever you prefer)
# Set global ggplot defaults
update_geom_defaults("line", list(color = presentation_two_colors[1]))
update_geom_defaults("bar",  list(fill = presentation_two_colors[1]))
update_geom_defaults("col",  list(fill = presentation_two_colors[1]))
#census_key <- "721190eb4f4e6f0c646422f469505567acec2241"
#census_api_key(census_key, install = TRUE)
ces <- readRDS("data/ces.RDS")
se <- readRDS("data/se.rds")
cpi <- readRDS("data/cpi.rds")
median_cpi <- readRDS("data/median_data.rds")
library(ggridges)
top_cut = 0.85
bottom_cut = 0.15
quarters_backwards <- (month(max(median_cpi$date)) + c(0, 3, 6, 9) - 1) %% 12 + 1
median_cpi %>%
mutate(dateF = as.factor(date)) %>%
filter(cumsumN <= top_cut & cumsum >= bottom_cut) %>%
filter(date >= "2020-01-01") %>%
filter(date != "2020-06-01") %>%
filter(date <= "2024-01-01") %>%
filter(month(date) %in% quarters_backwards) %>%
mutate(monthC = format(date, "%B, %Y")) %>%
mutate(monthC = fct_reorder(monthC, date)) %>%
mutate(monthCR = fct_rev(monthC)) %>%
ggplot(aes(x = Pchange3a, y = monthCR, fill = stat(x))) +
geom_density_ridges_gradient() +
theme_ridges() +
scale_x_continuous(labels = percent) +
theme_chartbook()
library(ggridges)
top_cut = 0.85
bottom_cut = 0.15
quarters_backwards <- (month(max(median_cpi$date)) + c(0, 3, 6, 9) - 1) %% 12 + 1
median_cpi %>%
mutate(dateF = as.factor(date)) %>%
filter(cumsumN <= top_cut & cumsum >= bottom_cut) %>%
filter(date >= "2020-01-01") %>%
filter(date != "2020-06-01") %>%
filter(date <= "2024-01-01") %>%
filter(month(date) %in% quarters_backwards) %>%
mutate(monthC = format(date, "%B, %Y")) %>%
mutate(monthC = fct_reorder(monthC, date)) %>%
mutate(monthCR = fct_rev(monthC)) %>%
ggplot(aes(x = Pchange3a, y = monthCR, fill = stat(x))) +
geom_density_ridges_gradient() +
theme_ridges() +
scale_x_continuous(labels = percent) +
theme_chartbook() +
theme(legend.position = "none")
msa_imm
state_lookup <- c(setNames(state.name, state.abb), PR = "Puerto Rico")
msa_fb2 <- msa_foreign_born %>%
mutate(
area_type = str_extract(name, "Metro Area|Micro Area"),
state_abbr = str_extract(name, ", [A-Z]{2}") %>% str_remove(", "),
state = state_lookup[state_abbr],
msa_name = str_remove(name, ", [A-Z]{2} .*"),
area_name = str_c(msa_name, ", ", state_abbr)
)
library(tidycensus)
vars_b05002 <- c(total = "B05002_001", foreign_born = "B05002_013")
msa_foreign_born <- get_acs(geography = "cbsa", variables = vars_b05002,
year = 2023, survey = "acs1", output = "wide") %>%
reframe(cbsa = GEOID, name = NAME, fb_share = foreign_bornE / totalE)
head(msa_foreign_born, 5)
state_lookup <- c(setNames(state.name, state.abb), PR = "Puerto Rico")
msa_fb2 <- msa_foreign_born %>%
mutate(
area_type = str_extract(name, "Metro Area|Micro Area"),
state_abbr = str_extract(name, ", [A-Z]{2}") %>% str_remove(", "),
state = state_lookup[state_abbr],
msa_name = str_remove(name, ", [A-Z]{2} .*"),
area_name = str_c(msa_name, ", ", state_abbr)
)
crosswalk <- read_csv("data/msa_crosswalk.csv")
msa_level <- se %>% filter(supersector_name == "Total Private",
data_type_text == "All Employees, In Thousands",
area_name != "Statewide",
seasonal == "U",
period != "M13") %>%
inner_join(msa_fb2, by = "area_name")
max_date <- max(msa_level$date)
msa_imm <- msa_level %>%
group_by(area_name) %>%
reframe(change_2025 = value[date == max_date]/value[date == max_date %m-% months(6)] - 1,
percent_immigrant = unique(fb_share)
)
msa_imm %>%
ggplot(aes(percent_immigrant, change_2025)) +
geom_point() +
theme_classic() +
geom_smooth(method = "lm") +
theme_chartbook() +
scale_y_continuous(label = percent) +
labs(x = "Percent foreign-born in 2023",
y = "Change in job growth",
subtitle = )
msa_imm
ces
ces
str(ces)
ces %>%
select(series_id, date, value, data_type_text, industry_name)
ces %>%
select(series_id, date, value, data_type_text, industry_name) %>% head
ces %>%
select(series_id, date, value, data_type_text, industry_name) %>%
head(5)
tariff_targets <- c(
"Appliances",
"Transportation commodities less motor fuel",
"Apparel",
"Household furnishings and supplies",
"Laundry equipment")
cpi %>% filter(item_name %in% tariff_targets) %>%
select(date, value, item_name) %>% head(5)
library(tidycensus)
head(se, 5) %>% select(series_id, date, value, industry_name, area_name)
library(tidycensus)
vars_b05002 <- c(total = "B05002_001", foreign_born = "B05002_013")
msa_foreign_born <- get_acs(geography = "cbsa", variables = vars_b05002,
year = 2023, survey = "acs1", output = "wide") %>%
reframe(cbsa = GEOID, name = NAME, fb_share = foreign_bornE / totalE)
head(msa_foreign_born, 5)
state_lookup <- c(setNames(state.name, state.abb), PR = "Puerto Rico")
msa_fb2 <- msa_foreign_born %>%
mutate(
area_type = str_extract(name, "Metro Area|Micro Area"),
state_abbr = str_extract(name, ", [A-Z]{2}") %>% str_remove(", "),
state = state_lookup[state_abbr],
msa_name = str_remove(name, ", [A-Z]{2} .*"),
area_name = str_c(msa_name, ", ", state_abbr)
)
crosswalk <- read_csv("data/msa_crosswalk.csv")
msa_level <- se %>% filter(supersector_name == "Total Private",
data_type_text == "All Employees, In Thousands",
area_name != "Statewide",
seasonal == "U",
period != "M13") %>%
inner_join(msa_fb2, by = "area_name")
max_date <- max(msa_level$date)
msa_imm <- msa_level %>%
group_by(area_name) %>%
reframe(change_2025 = value[date == max_date]/value[date == max_date %m-% months(6)] - 1,
percent_immigrant = unique(fb_share)
)
msa_imm %>%
ggplot(aes(percent_immigrant, change_2025)) +
geom_point() +
geom_smooth(method = "lm") +
theme_chartbook() +
scale_y_continuous(label = percent) +
scale_x_continuous(label = percent) +
labs(x = "Percent foreign-born in 2023",
y = "Change in job growth",
subtitle = "348 MSA Regions")
state_lookup <- c(setNames(state.name, state.abb), PR = "Puerto Rico")
msa_fb2 <- msa_foreign_born %>%
mutate(
area_type = str_extract(name, "Metro Area|Micro Area"),
state_abbr = str_extract(name, ", [A-Z]{2}") %>% str_remove(", "),
state = state_lookup[state_abbr],
msa_name = str_remove(name, ", [A-Z]{2} .*"),
area_name = str_c(msa_name, ", ", state_abbr)
)
crosswalk <- read_csv("data/msa_crosswalk.csv")
msa_level <- se %>% filter(supersector_name == "Total Private",
data_type_text == "All Employees, In Thousands",
area_name != "Statewide",
seasonal == "U",
period != "M13") %>%
inner_join(msa_fb2, by = "area_name")
max_date <- max(msa_level$date)
msa_imm <- msa_level %>%
group_by(area_name) %>%
reframe(change_2025 = value[date == max_date]/value[date == max_date %m-% months(6)] - 1,
percent_immigrant = unique(fb_share)
)
msa_imm %>%
ggplot(aes(percent_immigrant, change_2025)) +
geom_point() +
geom_smooth(method = "lm") +
theme_chartbook() +
scale_y_continuous(label = percent) +
scale_x_continuous(label = percent) +
labs(x = "Percent foreign-born in 2023",
y = "Change in job growth",
subtitle = "348 MSA Regions") +
theme(axis.title = element_text())
state_lookup <- c(setNames(state.name, state.abb), PR = "Puerto Rico")
msa_fb2 <- msa_foreign_born %>%
mutate(
area_type = str_extract(name, "Metro Area|Micro Area"),
state_abbr = str_extract(name, ", [A-Z]{2}") %>% str_remove(", "),
state = state_lookup[state_abbr],
msa_name = str_remove(name, ", [A-Z]{2} .*"),
area_name = str_c(msa_name, ", ", state_abbr)
)
crosswalk <- read_csv("data/msa_crosswalk.csv")
msa_level <- se %>% filter(supersector_name == "Total Private",
data_type_text == "All Employees, In Thousands",
area_name != "Statewide",
seasonal == "U",
period != "M13") %>%
inner_join(msa_fb2, by = "area_name")
max_date <- max(msa_level$date)
msa_imm <- msa_level %>%
group_by(area_name) %>%
reframe(change_2025 = value[date == max_date]/value[date == max_date %m-% months(6)] - 1,
percent_immigrant = unique(fb_share)
)
msa_imm %>%
ggplot(aes(percent_immigrant, change_2025)) +
geom_point() +
geom_smooth(method = "lm") +
theme_chartbook() +
scale_y_continuous(label = percent) +
scale_x_continuous(label = percent) +
labs(x = "Percent foreign-born in 2023",
y = "Change in job growth",
subtitle = "348 MSA Regions") +
theme(
axis.title.x = element_text(),
axis.title.y = element_text(angle = 90)
)
state_lookup <- c(setNames(state.name, state.abb), PR = "Puerto Rico")
msa_fb2 <- msa_foreign_born %>%
mutate(
area_type = str_extract(name, "Metro Area|Micro Area"),
state_abbr = str_extract(name, ", [A-Z]{2}") %>% str_remove(", "),
state = state_lookup[state_abbr],
msa_name = str_remove(name, ", [A-Z]{2} .*"),
area_name = str_c(msa_name, ", ", state_abbr)
)
crosswalk <- read_csv("data/msa_crosswalk.csv")
msa_level <- se %>% filter(supersector_name == "Total Private",
data_type_text == "All Employees, In Thousands",
area_name != "Statewide",
seasonal == "U",
period != "M13") %>%
inner_join(msa_fb2, by = "area_name")
max_date <- max(msa_level$date)
msa_imm <- msa_level %>%
group_by(area_name) %>%
reframe(change_2025 = value[date == max_date]/value[date == max_date %m-% months(6)] - 1,
percent_immigrant = unique(fb_share)
)
msa_imm %>%
ggplot(aes(percent_immigrant, change_2025)) +
geom_point() +
geom_smooth(method = "lm") +
theme_chartbook() +
scale_y_continuous(label = percent) +
scale_x_continuous(label = percent) +
labs(x = "Percent foreign-born in 2023",
y = "Change in job growth in 2025",
subtitle = "348 MSA Regions") +
theme(
axis.title.x = element_text(),
axis.title.y = element_text(angle = 90)
)
head(se, 5) %>% select(series_id, date, value, industry_name, area_name)
head(se, 5) %>% select(series_id, date, value, industry_name, area_name)
se
library(tidycensus)
se %>% select(series_id, date, value, data_type_text, area_name) %>%
head(5)
phillips_curve %>%
select(date, actual = core_pce, predicted = .fitted) %>%
pivot_longer(-date, names_to = "series", values_to = "value") %>%
filter(year(date)>= 2000) %>%
ggplot(aes(date, value, colour = series)) +
geom_line(size = 0.9) +
scale_y_continuous(labels = scales::percent) +
labs(title = "Core PCE Inflation: Actual vs Predicted",
x = NULL, subtitle = "Quarterly change annualized",
colour = NULL) +
theme_chartbook()
library(broom)
phillips_curve <-
getFRED(
unrate = "UNRATE", core_pce = "PCEPILFE",
exp_inf = "EXPINF10YR", keep_all = FALSE) %>%
left_join(getFRED("nrou") %>%
mutate(date = date %m+% months(2))) %>%
mutate(
core_pce = (core_pce / lag(core_pce, 3))^4 - 1,
exp_inf = exp_inf / 100,
unrate_gap = unrate / 100 - nrou / 100,
lag1 = lag(core_pce, 3), lag2 = lag(core_pce, 6)) %>%
filter(month(date) %in% c(3, 6, 9, 12)) %>%
# do and assign Phillips Curve regression pre-COVID
{
fit <- lm(core_pce ~ lag1 + lag2 + exp_inf + unrate_gap,
data = dplyr::filter(., date <= as.Date("2019-12-31"))
)
augment(fit, newdata = .)
}
phillips_curve %>%
select(date, actual = core_pce, predicted = .fitted) %>%
pivot_longer(-date, names_to = "series", values_to = "value") %>%
filter(year(date)>= 2000) %>%
ggplot(aes(date, value, colour = series)) +
geom_line(size = 0.9) +
scale_y_continuous(labels = scales::percent) +
labs(title = "Core PCE Inflation: Actual vs Predicted",
x = NULL, subtitle = "Quarterly change annualized",
colour = NULL) +
theme_chartbook()
phillips_curve %>%
select(date, actual = core_pce, predicted = .fitted) %>%
pivot_longer(-date, names_to = "series", values_to = "value") %>%
filter(year(date)>= 2000) %>%
ggplot(aes(date, value, colour = series)) +
geom_line(size = 0.9) +
scale_y_continuous(labels = scales::percent) +
labs(title = "Core PCE Inflation: Actual vs Predicted",
x = NULL, subtitle = "Quarterly change annualized",
colour = NULL) +
theme_chartbook() +
scale_chartbook_colors()
getFRED(cpi = "CPIAUCSL", median_cpi = "MEDCPIM158SFRBCLE", keep_all = FALSE) %>%
mutate(median_cpi = median_cpi/100, cpi = cpi/lag(cpi,1), cpi = cpi^12-1) %>%
filter(year(date) > 2017) %>%
pivot_longer(cpi:median_cpi, names_to = "type", values_to = "value") %>%
ggplot(aes(date, value, color=type)) +
geom_line() +
theme_chartbook() +
scale_chartbook_colors() +
scale_y_continuous(label=percent)
phillips_curve %>%
select(date, actual = core_pce, predicted = .fitted) %>%
pivot_longer(-date, names_to = "series", values_to = "value") %>%
filter(year(date)>= 2000) %>%
ggplot(aes(date, value, colour = series)) +
geom_line(size = 0.9) +
scale_y_continuous(labels = scales::percent) +
labs(title = "Core PCE Inflation: Actual vs Predicted",
x = NULL, subtitle = "Quarterly change annualized",
colour = NULL) +
theme_chartbook() +
scale_chartbook_colors()
state_lookup <- c(setNames(state.name, state.abb), PR = "Puerto Rico")
msa_fb2 <- msa_foreign_born %>%
mutate(
area_type = str_extract(name, "Metro Area|Micro Area"),
state_abbr = str_extract(name, ", [A-Z]{2}") %>% str_remove(", "),
state = state_lookup[state_abbr],
msa_name = str_remove(name, ", [A-Z]{2} .*"),
area_name = str_c(msa_name, ", ", state_abbr)
)
crosswalk <- read_csv("data/msa_crosswalk.csv")
msa_level <- se %>% filter(supersector_name == "Total Private",
data_type_text == "All Employees, In Thousands",
area_name != "Statewide",
seasonal == "U",
period != "M13") %>%
inner_join(msa_fb2, by = "area_name")
max_date <- max(msa_level$date)
msa_imm <- msa_level %>%
group_by(area_name) %>%
reframe(change_2025 = value[date == max_date]/value[date == max_date %m-% months(6)] - 1,
percent_immigrant = unique(fb_share)
)
msa_imm %>%
ggplot(aes(percent_immigrant, change_2025)) +
geom_point() +
geom_smooth(method = "lm") +
theme_chartbook() +
scale_y_continuous(labels = percent) +
scale_x_continuous(labels = percent) +
labs(x = "Percent foreign-born in 2023",
y = "Change in job growth in 2025",
subtitle = "2025 Job Growth versus Percent-Foreign Born 2023, 348 MSA Regions") +
theme(
axis.title.x = element_text(),
axis.title.y = element_text(angle = 90)
)
se
se$data_type_text
install.packages("tidyusmacro")
tidyusmacro
install.packages("available")
available::available("tidyusmacro")
knitr::opts_chunk$set(
echo = FALSE,
warning = FALSE,
message = FALSE
)
library(tidyverse)
library(govMacroTools)
library(lubridate)
library(scales)
library(glue)
library(blsR)
library(janitor)
library(showtext)
library(grid)
library(tidycensus)
font_add_google("Fira Sans", "fira")
showtext_auto()
knitr::opts_chunk$set(
fig.width = 7,   # narrower default width
fig.height = 2.8, # shorter default height
fig.align = "center",
out.width = "95%" # scale image within slide
)
knitr::knit_hooks$set(
size = function(before, options, envir) {
if (before) {
# before the chunk starts
paste0("\\", options$size)   # e.g. \tiny  \scriptsize
} else {
"\\normalsize"               # reset after the chunk
}
}
)
all_dates <- seq(from = as.Date("2000-01-01"), to = as.Date("2025-04-01"), by = "month")
create_chart_dates <- function(df, x){
return_dates <- sort(unique(df), decreasing = TRUE)
return_dates <- return_dates[seq(1, length(return_dates), x)]
return(return_dates)
}
theme_chartbook <- function() {
theme_void(base_family = "fira", base_size = 12) +
theme(
plot.title = element_text(size = 12, hjust = 0),
plot.title.position = "plot",
plot.background = element_rect(fill = NA, color = NA),
panel.background = element_rect(fill = NA, color = NA),
axis.text = element_text(size = 12),
axis.title = element_blank(),
panel.grid = element_blank(),
legend.title = element_blank()
)
}
scale_chartbook_colors <- function() {
scale_color_manual(values = presentation_two_colors)
}
scale_chartbook_fill <- function() {
scale_fill_manual(values = presentation_two_colors)
}
presentation_two_colors <- c("#2c3254", "#ff8361")  # Blue, red (or whatever you prefer)
# Set global ggplot defaults
update_geom_defaults("line", list(color = presentation_two_colors[1]))
update_geom_defaults("bar",  list(fill = presentation_two_colors[1]))
update_geom_defaults("col",  list(fill = presentation_two_colors[1]))
#census_key <- "721190eb4f4e6f0c646422f469505567acec2241"
#census_api_key(census_key, install = TRUE)
ces <- readRDS("data/ces.RDS")
se <- readRDS("data/se.rds")
cpi <- readRDS("data/cpi.rds")
median_cpi <- readRDS("data/median_data.rds")
