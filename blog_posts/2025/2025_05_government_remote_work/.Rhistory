# install.packages(c("ggthemes","scales")) if needed
# ── 1.  Economist-style horizontal bar chart ────────────────────────────────
cps %>%
filter(series_id %in% remote_codes_industry,            # keep the industries of interest
period != "M13") %>%                             # drop annual averages
mutate(value = value / 100) %>%                         # convert to share
arrange(series_title, date) %>%                         # ensure chronological order
group_by(series_title) %>%
mutate(change = last(value) - lag(value, 24)) %>%       # 24-month change
slice_tail(n = 1) %>%                                   # keep one row per industry
ungroup() %>%
mutate(series_title = str_wrap(series_title, 35)) %>%   # wrap long labels
arrange(change) %>%                                     # order for plotting
ggplot(aes(x = reorder(series_title, change),
y = change)) +
geom_col(fill = "#076fa2") +                            # Economist blue
geom_text(aes(label = percent(change, accuracy = 0.1)),
hjust = ifelse(change > 0, -0.15, 1.15),
size  = 3,
family = "sans") +
coord_flip(clip = "off") +                              # horizontal bars
scale_y_continuous(labels = percent_format(accuracy = 1),
expand = expansion(mult = c(0, 0.20))) +
labs(title    = "Remote work has risen most in white-collar industries",
subtitle = "Percentage-point change in share of workers teleworking, last two years",
caption  = "Source: IPUMS CPS microdata · @mtkonczal") +
theme_economist() +
theme(
axis.title          = element_blank(),
panel.grid.major.y  = element_blank(),                # no horizontal grid
plot.title.position = "plot",
plot.title          = element_text(size = 14, face = "bold"),
plot.subtitle       = element_text(size = 11),
plot.caption        = element_text(size = 8, hjust = 0),
plot.margin         = margin(10, 30, 10, 10)
)
# ── 0.  Packages ─────────────────────────────────────────────────────────────
library(tidyverse)   # dplyr, ggplot2, stringr, etc.
library(lubridate)   # %m-% for month arithmetic
library(scales)      # percent() formatting
library(ggthemes)    # theme_economist()
# install.packages(c("ggthemes","scales")) if needed
# ── 1.  Economist-style horizontal bar chart ────────────────────────────────
cps %>%
filter(series_id %in% remote_codes_industry,            # keep the industries of interest
period != "M13") %>%                             # drop annual averages
mutate(value = value / 100) %>%                         # convert to share
arrange(series_title, date) %>%                         # ensure chronological order
group_by(series_title) %>%
mutate(change = last(value) - lag(value, 24)) %>%       # 24-month change
slice_tail(n = 1) %>%                                   # keep one row per industry
ungroup() %>%
mutate(series_title = str_wrap(series_title, 35)) %>%   # wrap long labels
arrange(change) %>%                                     # order for plotting
ggplot(aes(x = reorder(series_title, change),
y = change)) +
geom_col(fill = "#076fa2") +                            # Economist blue
geom_text(aes(label = percent(change, accuracy = 0.1)),
hjust = ifelse(change > 0, -0.15, 1.15),
size  = 3,
family = "sans") +
coord_flip(clip = "off") +                              # horizontal bars
scale_y_continuous(labels = percent_format(accuracy = 1),
expand = expansion(mult = c(0, 0.20))) +
labs(title    = "Remote work has risen most in white-collar industries",
subtitle = "Percentage-point change in share of workers teleworking, last two years",
caption  = "Source: IPUMS CPS microdata · @mtkonczal") +
theme_economist() +
theme(
axis.title          = element_blank(),
panel.grid.major.y  = element_blank(),                # no horizontal grid
plot.title.position = "plot",
plot.title          = element_text(size = 14, face = "bold"),
plot.subtitle       = element_text(size = 11),
plot.caption        = element_text(size = 8, hjust = 0),
plot.margin         = margin(10, 30, 10, 10)
)
── 1.  Economist-style horizontal bar chart ────────────────────────────────
# ── 1.  Economist-style horizontal bar chart ────────────────────────────────
cps %>%
filter(series_id %in% remote_codes_industry,            # keep the industries of interest
period != "M13") %>%                             # drop annual averages
mutate(value = value / 100) %>%                         # convert to share
arrange(series_title, date) %>%                         # ensure chronological order
group_by(series_title) %>%
mutate(change = last(value) - lag(value, 24)) %>%       # 24-month change
slice_tail(n = 1) %>%                                   # keep one row per industry
ungroup() %>%
mutate(series_title = str_wrap(series_title, 35)) %>%   # wrap long labels
arrange(change) %>%                                     # order for plotting
ggplot(aes(x = reorder(series_title, change),
y = change)) +
geom_col(fill = "#076fa2") +                            # Economist blue
geom_text(aes(label = percent(change, accuracy = 0.1)),
hjust = ifelse(change > 0, -0.15, 1.15),
size  = 3,
family = "sans") +
coord_flip(clip = "off") +                              # horizontal bars
scale_y_continuous(labels = percent_format(accuracy = 1),
expand = expansion(mult = c(0, 0.20))) +
labs(title    = "Remote work has risen most in white-collar industries",
subtitle = "Percentage-point change in share of workers teleworking, last two years",
caption  = "Source: IPUMS CPS microdata · @mtkonczal")
# ── 0.  Packages ─────────────────────────────────────────────────────────────
library(tidyverse)
library(lubridate)
library(scales)
library(ggthemes)
# ── 1.  Prep data ────────────────────────────────────────────────────────────
plot_df <- cps %>%
filter(series_id %in% remote_codes_industry,          # keep the industries
period != "M13") %>%                          # drop annual averages
mutate(value = value / 100) %>%                      # to shares
group_by(series_title) %>%
reframe(
change = value[date == max(date)] -
value[date == max(date) %m-% months(24)]
) %>%
ungroup() %>%
arrange(change) %>%                                  # sort for plot order
mutate(
series_title = str_wrap(series_title, 35),
label        = percent(change, accuracy = 0.1),    # text to show
hjust_lbl    = ifelse(change > 0, -0.15, 1.15)     # text left/right
)
# ── 2.  Economist-style bar chart ────────────────────────────────────────────
ggplot(plot_df,
aes(x = reorder(series_title, change), y = change)) +
geom_col(fill = "#076fa2") +
geom_text(aes(label = label, hjust = hjust_lbl),          # uses pre-built label
size = 3, family = "sans", vjust = 0.5) +       # vjust keeps text centred
coord_flip(clip = "off") +
scale_y_continuous(labels = percent_format(accuracy = 1),
expand = expansion(mult = c(0, 0.20))) +
labs(
title    = "Remote work has risen most in white-collar industries",
subtitle = "Percentage-point change in share of workers teleworking, last two years",
caption  = "Source: IPUMS CPS microdata · @mtkonczal"
) +
theme_economist() +
theme(
axis.title.y        = element_blank(),
axis.title.x        = element_blank(),
panel.grid.major.y  = element_blank(),      # no horizontal grid
plot.title.position = "plot",
plot.title          = element_text(size = 14, face = "bold"),
plot.subtitle       = element_text(size = 11),
plot.caption        = element_text(size = 8, hjust = 0),
plot.margin         = margin(10, 30, 10, 10)
)
plot_df
# ── 1.  Prep data ────────────────────────────────────────────────────────────
plot_df <- cps %>%
filter(series_id %in% remote_codes_industry,          # keep the industries
period != "M13") %>%                          # drop annual averages
mutate(value = value / 100) %>%                      # to shares
group_by(series_title) %>%
reframe(
change = value[date == max(date)] -
value[date == max(date) %m-% months(24)]
) %>%
ungroup() %>%
arrange(change) %>%                                  # sort for plot order
mutate(
series_title = str_replace_all(series_title, "Percent, Persons who teleworked, ", ""),
label        = percent(change, accuracy = 0.1),    # text to show
hjust_lbl    = ifelse(change > 0, -0.15, 1.15)     # text left/right
)
# ── 2.  Economist-style bar chart ────────────────────────────────────────────
ggplot(plot_df,
aes(x = reorder(series_title, change), y = change)) +
geom_col(fill = "#076fa2") +
geom_text(aes(label = label, hjust = hjust_lbl),          # uses pre-built label
size = 3, family = "sans", vjust = 0.5) +       # vjust keeps text centred
coord_flip(clip = "off") +
scale_y_continuous(labels = percent_format(accuracy = 1),
expand = expansion(mult = c(0, 0.20))) +
labs(
title    = "Remote work has risen most in white-collar industries",
subtitle = "Percentage-point change in share of workers teleworking, last two years",
caption  = "Source: IPUMS CPS microdata · @mtkonczal"
) +
theme_economist() +
theme(
axis.title.y        = element_blank(),
axis.title.x        = element_blank(),
panel.grid.major.y  = element_blank(),      # no horizontal grid
plot.title.position = "plot",
plot.title          = element_text(size = 14, face = "bold"),
plot.subtitle       = element_text(size = 11),
plot.caption        = element_text(size = 8, hjust = 0),
plot.margin         = margin(10, 30, 10, 10)
)
some_all <- c("LNU0201B6FA", "LNU0201B788")
remote_sector <- cps %>% filter(series_id %in% some_all) %>%
mutate(value = value/100) %>%
filter(period != "M13")
remote_sector %>%
mutate(dateTag = if_else(date >= max(date), value, NA)) %>%
ggplot(aes(date, value, color = series_title)) +
geom_line(size = 1.2) +
geom_text(aes(date, dateTag, color=series_title, label = percent(dateTag)), nudge_x = 35, show.legend = FALSE) +
geom_point(aes(date, dateTag, color=series_title), size = 4, show.legend = FALSE) +
scale_y_continuous(label = percent) +
labs(title = "Federal Government Workers Now Not Working From Home",
subtitle = "Percent of total at work. Persons who teleworked or worked at home, some or all hours. Not seasonally adjusted.",
caption = "Current population survey. Series starts in October 2022. Mike Konczal") +
scale_x_date(date_labels = "%b\n%Y") +
scale_fill_brewer(palette = "Paired") +
theme(plot.title.position = "plot",
legend.position = "top")
# Graphic 2: By Industry ------
plot_df <- cps %>%
filter(series_id %in% remote_codes_industry,          # keep the industries
period != "M13") %>%                          # drop annual averages
mutate(value = value / 100) %>%                      # to shares
group_by(series_title) %>%
reframe(
change = value[date == max(date)] -
value[date == max(date) %m-% months(24)]
) %>%
ungroup() %>%
arrange(change) %>%                                  # sort for plot order
mutate(
series_title = str_replace_all(series_title, "Percent, Persons who teleworked, ", ""),
label        = percent(change, accuracy = 0.1),    # text to show
hjust_lbl    = ifelse(change > 0, -0.15, 1.15)     # text left/right
)
ggplot(plot_df,
aes(x = reorder(series_title, change), y = change)) +
geom_col(fill = "#076fa2") +
geom_text(aes(label = label, hjust = hjust_lbl),          # uses pre-built label
size = 3, family = "sans", vjust = 0.5) +       # vjust keeps text centred
coord_flip(clip = "off") +
scale_y_continuous(labels = percent_format(accuracy = 1),
expand = expansion(mult = c(0, 0.20))) +
labs(
title    = "Remote work has risen most in industries",
subtitle = "Percentage-point change in share of workers teleworking, last two years",
caption  = "Source: IPUMS CPS microdata · @mtkonczal"
) +
theme_economist() +
theme(
axis.title.y        = element_blank(),
axis.title.x        = element_blank(),
panel.grid.major.y  = element_blank(),      # no horizontal grid
plot.title.position = "plot",
plot.title          = element_text(size = 14, face = "bold"),
plot.subtitle       = element_text(size = 11),
plot.caption        = element_text(size = 8, hjust = 0),
plot.margin         = margin(10, 30, 10, 10)
)
ggplot(plot_df,
aes(x = reorder(series_title, change), y = change)) +
geom_line(color = "#076fa2", size =1.2) +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
labs(
title    = "Remote work has risen most in industries",
subtitle = "Percentage-point change in share of workers teleworking, last two years",
caption  = "Source: IPUMS CPS microdata · @mtkonczal"
) +
facet_wrap(~series_title, scales = "free") +
theme_economist() +
theme(
axis.title.y        = element_blank(),
axis.title.x        = element_blank(),
panel.grid.major.y  = element_blank(),      # no horizontal grid
plot.title.position = "plot",
plot.title          = element_text(size = 14, face = "bold"),
plot.subtitle       = element_text(size = 11),
plot.caption        = element_text(size = 8, hjust = 0),
plot.margin         = margin(10, 30, 10, 10)
)
plot_df <- cps %>%
filter(series_id %in% remote_codes_industry,          # keep the industries
period != "M13") %>%                          # drop annual averages
mutate(value = value / 100) %>%                      # to shares
mutate(
series_title = str_replace_all(series_title, "Percent, Persons who teleworked, ", "")
)
ggplot(plot_df,
aes(x = reorder(series_title, change), y = change)) +
geom_line(color = "#076fa2", size =1.2) +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
labs(
title    = "Remote work has risen most in industries",
subtitle = "Percentage-point change in share of workers teleworking, last two years",
caption  = "Source: IPUMS CPS microdata · @mtkonczal"
) +
facet_wrap(~series_title, scales = "free") +
theme_economist() +
theme(
axis.title.y        = element_blank(),
axis.title.x        = element_blank(),
panel.grid.major.y  = element_blank(),      # no horizontal grid
plot.title.position = "plot",
plot.title          = element_text(size = 14, face = "bold"),
plot.subtitle       = element_text(size = 11),
plot.caption        = element_text(size = 8, hjust = 0),
plot.margin         = margin(10, 30, 10, 10)
)
# Facet in footnotes ----
plot_df <- cps %>%
filter(series_id %in% remote_codes_industry,          # keep the industries
period != "M13") %>%                          # drop annual averages
mutate(value = value / 100) %>%                      # to shares
mutate(
series_title = str_replace_all(series_title, "Percent, Persons who teleworked, ", "")
)
ggplot(plot_df,
aes(date, value)) +
geom_line(color = "#076fa2", size =1.2) +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
labs(
title    = "Remote work has risen most in industries",
subtitle = "Percentage-point change in share of workers teleworking, last two years",
caption  = "Source: IPUMS CPS microdata · @mtkonczal"
) +
facet_wrap(~series_title, scales = "free") +
theme_economist() +
theme(
axis.title.y        = element_blank(),
axis.title.x        = element_blank(),
panel.grid.major.y  = element_blank(),      # no horizontal grid
plot.title.position = "plot",
plot.title          = element_text(size = 14, face = "bold"),
plot.subtitle       = element_text(size = 11),
plot.caption        = element_text(size = 8, hjust = 0),
plot.margin         = margin(10, 30, 10, 10)
)
ggplot(plot_df,
aes(date, value)) +
geom_line(color = "#076fa2", size =1.2) +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
labs(
title    = "Remote work has risen most in industries",
subtitle = "Percentage-point change in share of workers teleworking, last two years",
caption  = "Source: IPUMS CPS microdata · @mtkonczal"
) +
facet_wrap(~series_title, scales = "free") +
theme_classic() +
theme(
axis.title.y        = element_blank(),
axis.title.x        = element_blank(),
panel.grid.major.y  = element_blank(),      # no horizontal grid
plot.title.position = "plot",
plot.title          = element_text(size = 14, face = "bold"),
plot.subtitle       = element_text(size = 11),
plot.caption        = element_text(size = 8, hjust = 0)
)
remote_codes_government <- c("LNU0201B678", "LNU0201B66C", "LNU0201B66E")
remote_sector <- cps %>% filter(series_id %in% remote_codes_government) %>%
mutate(value = value/100) %>%
filter(period != "M13")
remote_sector %>%
mutate(dateTag = if_else(date >= max(date), value, NA)) %>%
ggplot(aes(date, value, color = series_title)) +
geom_line(size = 1.2) +
geom_text(aes(date, dateTag, color=series_title, label = percent(dateTag)), nudge_x = 35, show.legend = FALSE) +
geom_point(aes(date, dateTag, color=series_title), size = 4, show.legend = FALSE) +
scale_y_continuous(label = percent) +
labs(title = "Federal Government Workers Now Not Working From Home",
subtitle = "Percent of total at work. Persons who teleworked or worked at home, some or all hours. Not seasonally adjusted.",
caption = "Current population survey. Series starts in October 2022. Mike Konczal") +
scale_x_date(date_labels = "%b\n%Y") +
scale_fill_brewer(palette = "Paired") +
theme(plot.title.position = "plot",
legend.position = "top")
# ── 0.  Libraries ────────────────────────────────────────────────────────────
library(tidyverse)
library(lubridate)
library(ipumsr)
library(janitor)
library(haven)      # labelled → factor
# ── 1.  Read the CPS Basic-Monthly extract (2015, 2019, 2024) ────────────────
cps <- read_ipums_micro("cps_00004.xml") %>%
clean_names()
# ── 0.  Libraries ────────────────────────────────────────────────────────────
library(tidyverse)
library(lubridate)
library(ipumsr)
library(janitor)
library(haven)      # labelled → factor
# ── 1.  Read the CPS Basic-Monthly extract (2015, 2019, 2024) ────────────────
cps <- read_ipums_micro("cps_00004.xml") %>%
clean_names()
# ── 0.  Libraries ────────────────────────────────────────────────────────────
library(tidyverse)
library(lubridate)
library(ipumsr)
library(janitor)
library(haven)      # labelled → factor
# ── 1.  Read the CPS Basic-Monthly extract (2015, 2019, 2024) ────────────────
cps <- read_ipums_micro("cps_00004.xml") %>%
clean_names()
test <- cps %>% filter(year == 2024)
test
test$earnweek2
test <- cps %>% filter(year == 2024, empstat %in% c(10, 12)
)
test
test <- cps %>% filter(year == 2024, empstat %in% c(10, 12))
test$earnweek2
test$hourwage2
test$earnweek2
test <- cps %>% filter(year == 2024, empstat %in% c(10, 12), earnweek2 != 999999.99)
test$earnweek2
a <- lm(earnweek2 ~ educ + age + sex)
a <- lm(earnweek2 ~ educ + age + sex, data = test)
summary(a)
a <- lm(earnweek2 ~ educ + age + sex + ind, data = test)
summary(a)
a$ind
test$ind
# ── 0.  Libraries ────────────────────────────────────────────────────────────
library(tidyverse)
library(lubridate)
library(ipumsr)
library(janitor)
library(haven)      # labelled → factor
# ── 1.  Read the CPS Basic-Monthly extract (2015, 2019, 2024) ────────────────
cps <- read_ipums_micro("cps_00004.xml") %>%
clean_names() %>%
mutate(indF = as.factor(ind))
test <- cps %>% filter(year == 2024, empstat %in% c(10, 12), earnweek2 != 999999.99)
test$earnweek2
a <- lm(earnweek2 ~ educ + age + sex + indF, data = test)
summary(a)
cps
cps$telwrkhr
# ── 0.  Libraries ────────────────────────────────────────────────────────────
library(tidyverse)
library(lubridate)
library(ipumsr)
library(janitor)
library(haven)      # labelled → factor
# ── 1.  Read the CPS Basic-Monthly extract (2015, 2019, 2024) ────────────────
cps <- read_ipums_micro("cps_00004.xml") %>%
clean_names() %>%
mutate(indF = as.factor(ind),
telwrkhrF = telwrkhr > 0)
test <- cps %>% filter(year == 2024, empstat %in% c(10, 12), earnweek2 != 999999.99)
test$earnweek2
a <- lm(earnweek2 ~ educ + age + sex + indF + telwrkhrF, data = test)
summary(a)
# ── 0.  Libraries ────────────────────────────────────────────────────────────
library(tidyverse)
library(lubridate)
library(ipumsr)
library(janitor)
library(haven)      # labelled → factor
# ── 1.  Read the CPS Basic-Monthly extract (2015, 2019, 2024) ────────────────
cps <- read_ipums_micro("cps_00004.xml") %>%
clean_names() %>%
mutate(indF = as.factor(ind),
telwrkhrF = telwrkhr > 0)
test <- cps %>% filter(year == 2024, empstat %in% c(10, 12), earnweek2 != 999999.99)
test$earnweek2
a <- lm(earnweek2 ~ educ + age + sex + indF + telwrkhrF, data = test)
summary(a)
a <- lm(earnweek2 ~ telwrkhrF + educ + age + sex + indF, data = test)
summary(a)
test$telwrkhrF
summary(test$telwrkhrF)
summary(test$telwrkhr)
test$telwrkhr
summary(test$telwrkhr)
cps$telwrkpay
summary(cps$telwrkpay)
# ── 0.  Libraries ────────────────────────────────────────────────────────────
library(tidyverse)
library(lubridate)
library(ipumsr)
library(janitor)
library(haven)      # labelled → factor
# ── 1.  Read the CPS Basic-Monthly extract (2015, 2019, 2024) ────────────────
cps <- read_ipums_micro("cps_00004.xml") %>%
clean_names() %>%
mutate(indF = as.factor(ind),
telwrkpayF = telwrkpay == 1)
test <- cps %>% filter(year == 2024, empstat %in% c(10, 12), earnweek2 != 999999.99)
test$earnweek2
a <- lm(earnweek2 ~ telwrkpayF + educ + age + sex + indF, data = test)
summary(a)
summary(test$telwrkhr)
a <- lm(earnweek2 ~ telwrkpayF + educ + age + sex + indF + occF, data = test)
# ── 1.  Read the CPS Basic-Monthly extract (2015, 2019, 2024) ────────────────
cps <- read_ipums_micro("cps_00004.xml") %>%
clean_names() %>%
mutate(indF = as.factor(ind),
occF = as.factor(occ),
telwrkpayF = telwrkpay == 1)
test <- cps %>% filter(year == 2024, empstat %in% c(10, 12), earnweek2 != 999999.99)
test$earnweek2
a <- lm(earnweek2 ~ telwrkpayF + educ + age + sex + indF + occF, data = test)
summary(a)
head(summary(a), 100)
summary(a)
a <- lm(earnweek2 ~ telwrkpayF + educ + age + sex + indF + occF, data = test, weights = earnw44t)
a <- lm(earnweek2 ~ telwrkpayF + educ + age + sex + indF + occF, data = test, weights = earnwt)
test$earnwt
a$earnweek
a$earnweek2
test$earnweek2
test <- cps %>% filter(year == 2024, empstat %in% c(10, 12), earnweek2 != 1000000)
summary(cps$earnweek2)
test <- cps %>% filter(year == 2024, empstat %in% c(10, 12), earnweek2 != 1000000)
test$earnweek2
a <- lm(earnweek2 ~ telwrkpayF + educ + age + sex + indF + occF, data = test, weights = earnwt)
a <- lm(earnweek2 ~ telwrkpayF + educ + age + sex, data = test, weights = earnwt)
lm(earnweek2 ~ telwrkpayF + educ + age + sex, data = test, weights = wtf)
lm(earnweek2 ~ telwrkpayF + educ + age + sex, data = test, weights = earnwt)
